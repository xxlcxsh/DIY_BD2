{% extends "main/base.html" %}
{% load form_tags %}

{% block content %}
<div class="container">
    <h1 class="mb-4">{{ title }}</h1>
    <form method="post" novalidate>
        {% csrf_token %}

        <div class="mb-3">
            <label for="{{ form.name.id_for_label }}" class="form-label">Название проекта:</label>
            {{ form.name|add_class:"form-control" }}
            {% if form.name.errors %}
                <div class="text-danger">{{ form.name.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="{{ form.description.id_for_label }}" class="form-label">Описание:</label>
            {{ form.description|add_class:"form-control" }}
            {% if form.description.errors %}
                <div class="text-danger">{{ form.description.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="{{ form.due_date.id_for_label }}" class="form-label">Дедлайн:</label>
            {{ form.due_date|add_class:"form-control" }}
            {% if form.due_date.errors %}
                <div class="text-danger">{{ form.due_date.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="{{ form.for_sale.id_for_label }}" class="form-label">На продажу?</label>
            {{ form.for_sale|add_class:"form-check-input" }}
            {% if form.for_sale.errors %}
                <div class="text-danger">{{ form.for_sale.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3" id="customer_field">
            <label for="{{ form.customer_name.id_for_label }}" class="form-label">Заказчик:</label>
            {{ form.customer_name|add_class:"form-control" }}
            {% if form.customer_name.errors %}
                <div class="text-danger">{{ form.customer_name.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3" id="price_field">
            <label for="{{ form.price.id_for_label }}" class="form-label">Цена:</label>
            {{ form.price|add_class:"form-control" }}
            {% if form.price.errors %}
                <div class="text-danger">{{ form.price.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label for="{{ form.amount.id_for_label }}" class="form-label">Количество</label>
            {{ form.amount|add_class:"form-control" }}
            {% if form.amount.errors %}
                <div class="text-danger">{{ form.amount.errors }}</div>
            {% endif %}
        </div>

        <div class="mb-3">
            <label class="form-label">Компоненты:</label>
            {{ form.components }}
            {% if form.components.errors %}
                <div class="text-danger">{{ form.components.errors }}</div>
            {% endif %}
            <div class="form-text">Выберите компоненты, которые будут использованы в проекте.</div>
        </div>

        <div class="mb-3">
            <label for="{{ form.component_amounts.id_for_label }}" class="form-label">Количество компонентов:</label>
            {{ form.component_amounts|add_class:"form-control" }}
            {% if form.component_amounts.errors %}
                <div class="text-danger">{{ form.component_amounts.errors }}</div>
            {% endif %}
            <div class="form-text">Введите количество для каждого компонента, разделяя их запятыми.</div>
        </div>

        {% if title == 'Редактировать проект' %}
            <button type="submit" class="btn btn-primary">Внести изменения</button>
        {% else %}
            <button type="submit" class="btn btn-primary">Создать проект</button>
        {% endif %}

        <script>
        // Скрипт для управления доступностью полей "Заказчик" и "Цена"
        document.addEventListener('DOMContentLoaded', function() {
            const forSale = document.getElementById('{{ form.for_sale.id_for_label }}');
            const customerInput = document.querySelector('#customer_field input, #customer_field select, #customer_field textarea');
            const priceInput = document.querySelector('#price_field input, #price_field select, #price_field textarea');
            function toggleFields() {
                const enabled = forSale.checked;
                if(customerInput) customerInput.disabled = !enabled;
                if(priceInput) priceInput.disabled = !enabled;
            }
            toggleFields();
            forSale.addEventListener('change', toggleFields);
        });
        </script>

    </form>
</div>
{% endblock %}
